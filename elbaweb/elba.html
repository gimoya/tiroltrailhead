<html>
<head>
	<meta charset=utf-8>
		<title>ELBA SINGLETRAILS</title>
	</meta>	
	<link rel="stylesheet" href="//cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
	<script src="//cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<link rel="stylesheet" href="maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
	<script src='//api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
	<style>
		body { margin:0; padding:0; }
		#map { position:absolute; top:0; bottom:0; width:100%; }
	</style>
</head>
<body>

<div id="map"></div>
	<script language="javascript">

		var mtbmapAttr = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
		  '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
		  'Tiles ï¿½ <a href="http://mtbmap.cz">mtbmap</a>';
		var mtbmapUrl = 'http://tile.mtbmap.cz/mtbmap_tiles/{z}/{x}/{y}.png';

		var kompassAttr = 'Tiles &copy; <a href="http://kompass.de">' +
		  'Kompass Wanderkarten</a>';
		var kompassUrl = 'http://ec2.cdn.ecmaps.de/WmsGateway.ashx.jpg?Experience=kompass&MapStyle=KOMPASS%20Touristik&TileX={x}&TileY={y}&ZoomLevel={z}';

		var mtbmapLayer = L.tileLayer(mtbmapUrl, {
		  attribution: mtbmapAttr
		});

		var kompassLayer = L.tileLayer(kompassUrl, {
		  attribution: kompassAttr
		});
						
		var goodKml = omnivore.kml('../elbaweb/KMLs/good/good.kml')
			.on('ready', function() {
							// After the 'ready' event fires, the GeoJSON contents are accessible
							// and you can iterate through layers to bind custom popups
							this.eachLayer(function(layer) {
								// See the `.bindPopup` documentation for full details
								layer.bindPopup('<style>td {font-size: 1.5ex;} span {font-size: 2ex;}"</style><span><strong>'+layer.feature.properties.name+'</strong></span><p/>'+layer.feature.properties.description);
								layer.setStyle({weight: 3,
												opacity: 0.7,
												color: 'blue',
												dashArray: '4'}) 
							});
						});
							
		var gehtsoKml = omnivore.kml('../elbaweb/KMLs/gethso/gehtso.kml')
			.on('ready', function() {
							this.eachLayer(function(layer) {
							layer.bindPopup('<style>td {font-size: 1.5ex;} span {font-size: 2ex;}"</style><span><strong>'+layer.feature.properties.name+'</strong></span><p/>'+layer.feature.properties.description);
								layer.setStyle({weight: 3,
												opacity: 0.7,
												color: 'orange',
												dashArray: '4'}) 
							});							
						});						
						
		var badKml = omnivore.kml('../elbaweb/KMLs/bad/bad.kml')
			.on('ready', function() {
							this.eachLayer(function(layer) {
							layer.bindPopup('<style>td {font-size: 1.5ex;} span {font-size: 2ex;}"</style><span><strong>'+layer.feature.properties.name+'</strong></span><p/>'+layer.feature.properties.description);
								layer.setStyle({weight: 3,
												opacity: 0.7,
												color: 'red',
												dashArray: '4'}) 
							});							
						});
						
		var ideeKml = omnivore.kml('../elbaweb/KMLs/idee/idee.kml')
			.on('ready', function() {
							this.eachLayer(function(layer) {
							layer.bindPopup('<style>td {font-size: 1.5ex;} span {font-size: 2ex;}"</style><span><strong>'+layer.feature.properties.name+'</strong></span><p/>'+layer.feature.properties.description);
								layer.setStyle({weight: 3,
												opacity: 0.7,
												color: 'green',
												dashArray: '4'}) 
							});							
						});
		// not used:				
		var dahlKml = omnivore.kml('../elbaweb/KMLs/DAHL.kml')
			.on('ready', function() {
							// After the 'ready' event fires, the GeoJSON contents are accessible
							// and you can iterate through layers to bind custom popups
							this.eachLayer(function(layer) {
								// See the `.bindPopup` documentation for full details
								layer.bindPopup('<style>td {font-size: 1.5ex;} span {font-size: 2ex;}"</style><span><strong>'+layer.feature.properties.name+'</strong></span><p/>'+layer.feature.properties.description);
								layer.setStyle({weight: 4,
												opacity: 0.5,
												color: 'darkgrey',
												dashArray: '1'}) 
							});
						});
						
						
		/*
		For highlighting features see:
		http://stackoverflow.com/questions/32971673/how-do-you-make-a-highlighted-outline-appear-in-leaflet-js-on-mouseover-and-by-h
		*/		
		var style = {
			'default': {
				'weight': 3,
				'opacity': 0.7
			},
			'highlight': {
				'weight': 5,
				'opacity': 0.9
			}
		};
		
		// Variable for storing highlighted layer
		var highlight;

		function setHighlight (layer) {
		  // Check if something's highlighted, if so unset highlight
		  if (highlight) {
			unsetHighlight(highlight);
		  }
		  // Set highlight style on layer and store to variable
		  layer.setStyle(style.highlight);
		  highlight = layer;
		}

		function unsetHighlight (layer) {
		  // Set default style and clear variable
		  layer.setStyle(style.default);
		  highlight = null;
		}

		var groupKML = new L.LayerGroup([
			goodKml,
			badKml,
			gehtsoKml,
			ideeKml
		]);

		// Iterate over groupKML
		groupKML.eachLayer(function (layer) {
		
			// Mouseover handler
			layer.on('mouseover', function (e) {
				// Set highlight
				setHighlight(layer);
			});

			// Mouseout handler
			layer.on('mouseout', function (e) {
				 // Unset highlight
				unsetHighlight(layer);
			});
		});
		
		var baseLayers = {
		  "Kompass Wanderkarte": kompassLayer,
		  "OSM-MTBMap": mtbmapLayer
		};

		var overlays = {
		  "Good Singletrails": goodKml,
		  "Quite good Singletrails": gehtsoKml,
		  "Maybe good??": ideeKml,
		  "Bad Singletrails": badKml
		};
			 
		var map = L.map('map', {
		  center: [42.79,10.28],
		  zoom: 12,
		  layers: [kompassLayer, goodKml, gehtsoKml, ideeKml, badKml]  
		});
		
		L.control.layers(baseLayers, overlays).addTo(map);

	</script>
</body>	
</html>
