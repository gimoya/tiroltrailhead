<html>
<head>
<title>ELBA GRAVITY PARK</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://unpkg.com/leaflet-easybutton@2.0.0/src/easy-button.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">	
	
	<!-- GOOGLE FONTS -->	
	<link href='http://fonts.googleapis.com/css?family=Bangers|Fugaz+One|Hanalei|Ranga|Russo+One|Timmana|Ultra|Exo:Bold|Fredoka+One|Sigmar+One|BioRhyme|Black+Ops+One|Bungee|Bungee+Shade|Creepster|Ewert|Fruktur|Gravitas+One|Monoton|Rubik:900' rel='stylesheet' type='text/css'>	
	<!-- GOOGLE FONTS -->

	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
	<script src="//lightwidget.com/widgets/lightwidget.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>	
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<script src="https://unpkg.com/leaflet-easybutton@2.0.0/src/easy-button.js"></script>
	
	<!--link rel="stylesheet" href="https://domoritz.github.io/leaflet-locatecontrol/dist/L.Control.Locate.min.css" />
	<script src="https://domoritz.github.io/leaflet-locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script-->
	
    <style type="text/css">
	    
	html, body {
		font-size: 100%;
		height: 100%;
		padding: 0;
		margin: 0;
	}
	
	.custom-control {
		font-family: Exo;
	}
  
	#map {
		position: absolute;
		width: 100%;
		height: 100%;
	}
	    
	#infopanel {
		display: none; 
		position: fixed; 
		z-index: 100; 
		background-color: rgba(0,0,0,0.70); 
		width: 33%; 
		height: 100%;
		color: white;
	}
  
	#photos {
		width: 100%;
	}
	    
	#title {
		font-size: 2.5em;
	}
	    
	#info, #tracks {
		font-family: 'Corbel', 'bold';
		font-size: 1em;
	}
	    
	#info, #tracks, #title {
		padding: 10px;
	}
	    
	#layer-name-info {
		position: absolute;
		right: 10px;
		z-index: 400;
		padding: 0.4em;
	    	bottom: 12.5em;		
	}
	    
	#logo {
		position: absolute;
		right: 0px;
		bottom: 0px;
		z-index: 99;
		padding-bottom: 1.2em;
		height: 12em;		
	}
	    
	@media screen and (max-width: 480px) {
		body {
			font-size: 75%;
		}
		#infopanel {
			width: 50%; 
		}	
		#info, #layer-name-info {
			display:none;
		}
		#tracks {
			font-size:1.5em;
		}
	}
    
	</style>
</head>
<body>
<div id="layer-name-info" class="leaflet-bar">...</div>
<div id="infopanel">
	<div id="photos"></div>
	<div id="title"></div>
	<div id="info"></div>
	<div id="tracks">
		<a id="gpx" href="">GPX</a> | <a id="kml" href="">KML</a>
	</div>
</div>
	<img id="logo" src="elba_gravity_park.png"></img>
<div id="map">
</div>
<script language="javascript">	

	var mapbox_Attr = 'Tiles &copy; <a href="https://www.mapbox.com">mapbox</a>';  
	var mapbox_satelliteUrl = 'https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZ2ltb3lhIiwiYSI6IkZrTld6NmcifQ.eY6Ymt2kVLvPQ6A2Dt9zAQ';
	var mapbox_outdoorUrl = 'https://api.mapbox.com/styles/v1/mapbox/outdoors-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZ2ltb3lhIiwiYSI6IkZrTld6NmcifQ.eY6Ymt2kVLvPQ6A2Dt9zAQ';

	var mapbox_satelliteLayer = L.tileLayer(mapbox_satelliteUrl, {
	  attribution: mapbox_Attr 
	});

	var mapbox_outdoorLayer = L.tileLayer(mapbox_outdoorUrl, {
	  attribution: mapbox_Attr 
	});		

	var CimaDelMonteKML = omnivore.kml('../elba/KML/CimaDelMonte.kml')
		.on('click', function(e) {
			$("#photos").html('<iframe src="//lightwidget.com/widgets/b1c24146915358abaa91dadd776e6e25.html" scrolling="no" allowtransparency="true" class="lightwidget-widget" style="width: 100%; border: 0; overflow: hidden;"></iframe>');
			$("#title").css("font-family", "Monoton");
			$("#title").html(e.layer.feature.properties.name);
			$("#info").html(e.layer.feature.properties.description);
			$("#gpx").prop('href', '../elba/KML/CimaDelMonte.gpx');
			$("#kml").prop('href', '../elba/KML/CimaDelMonte.kml');
			$("#infopanel").fadeIn("slow");
		});			

	var LaBuccaDelBandito1KML = omnivore.kml('../elba/KML/LaBuccaDelBandito1.kml')
		.on('click', function(e) {
			$("#photos").html('<iframe src="//lightwidget.com/widgets/b1c24146915358abaa91dadd776e6e25.html" scrolling="no" allowtransparency="true" class="lightwidget-widget" style="width: 100%; border: 0; overflow: hidden;"></iframe>');
			$("#title").css("font-family", "Creepster");
			$("#title").html(e.layer.feature.properties.name);
			$("#info").html(e.layer.feature.properties.description);
			$("#gpx").prop('href', '../elba/KML/LaBuccaDelBandito1.gpx');
			$("#kml").prop('href', '../elba/KML/LaBuccaDelBandito1.kml');
			$("#infopanel").fadeIn("slow");
		});			

	var LaBuccaDelBandito2KML = omnivore.kml('../elba/KML/LaBuccaDelBandito2.kml')
		.on('click', function(e) {
			$("#photos").html('<iframe src="//lightwidget.com/widgets/b1c24146915358abaa91dadd776e6e25.html" scrolling="no" allowtransparency="true" class="lightwidget-widget" style="width: 100%; border: 0; overflow: hidden;"></iframe>');
			$("#title").css("font-family", "Creepster");
			$("#title").html(e.layer.feature.properties.name);
			$("#info").html(e.layer.feature.properties.description);
			$("#gpx").prop('href', '../elba/KML/LaBuccaDelBandito2.gpx');
			$("#kml").prop('href', '../elba/KML/LaBuccaDelBandito2.kml');
			$("#infopanel").fadeIn("slow");
		});			

	var LaghettoRossoKML = omnivore.kml('../elba/KML/LaghettoRosso.kml')
		.on('click', function(e) {
			$("#photos").html('<iframe src="//lightwidget.com/widgets/b1c24146915358abaa91dadd776e6e25.html" scrolling="no" allowtransparency="true" class="lightwidget-widget" style="width: 100%; border: 0; overflow: hidden;"></iframe>');
			$("#title").css("font-family", "Ultra");
			$("#title").html(e.layer.feature.properties.name);
			$("#info").html(e.layer.feature.properties.description);
			$("#gpx").prop('href', '../elba/KML/LaghettoRosso.gpx');
			$("#kml").prop('href', '../elba/KML/LaghettoRosso.kml');
			$("#infopanel").fadeIn("slow");
		});			

	var MezzaStregaKML = omnivore.kml('../elba/KML/MezzaStrega.kml')
		.on('click', function(e) {
			$("#photos").html('<iframe src="//lightwidget.com/widgets/b1c24146915358abaa91dadd776e6e25.html" scrolling="no" allowtransparency="true" class="lightwidget-widget" style="width: 100%; border: 0; overflow: hidden;"></iframe>');
			$("#title").css("font-family", "Gravitas One");
			$("#title").html(e.layer.feature.properties.name);
			$("#info").html(e.layer.feature.properties.description);
			$("#gpx").prop('href', '../elba/KML/MezzaStrega.gpx');
			$("#kml").prop('href', '../elba/KML/MezzaStrega.kml');
			$("#infopanel").fadeIn("slow");
		});

	var StregaKML = omnivore.kml('../elba/KML/Strega.kml')
		.on('click', function(e) {
			$("#photos").html('<iframe src="//lightwidget.com/widgets/b1c24146915358abaa91dadd776e6e25.html" scrolling="no" allowtransparency="true" class="lightwidget-widget" style="width: 100%; border: 0; overflow: hidden;"></iframe>');
			$("#title").css("font-family", "Fugaz One");
			$("#title").html(e.layer.feature.properties.name);
			$("#info").html(e.layer.feature.properties.description);
			$("#gpx").prop('href', '../elba/KML/Strega.gpx');
			$("#kml").prop('href', '../elba/KML/Strega.kml');
			$("#infopanel").fadeIn("slow");
		});
		
	var ScaletteKML = omnivore.kml('../elba/KML/Scalette.kml')
		.on('click', function(e) {
			$("#photos").html('<iframe src="//lightwidget.com/widgets/b1c24146915358abaa91dadd776e6e25.html" scrolling="no" allowtransparency="true" class="lightwidget-widget" style="width: 100%; border: 0; overflow: hidden;"></iframe>')
			$("#title").css("font-family", "Hanalei");
			$("#title").html(e.layer.feature.properties.name);
			$("#info").html(e.layer.feature.properties.description);
			$("#gpx").prop('href', '../elba/KML/Scalette.gpx');
			$("#kml").prop('href', '../elba/KML/Scalette.kml');
			$("#infopanel").fadeIn("slow");
		});			

	var VigniolaKML = omnivore.kml('../elba/KML/Vigniola.kml')
		.on('click', function(e) {
			$("#photos").html('<iframe src="//lightwidget.com/widgets/b1c24146915358abaa91dadd776e6e25.html" scrolling="no" allowtransparency="true" class="lightwidget-widget" style="width: 100%; border: 0; overflow: hidden;"></iframe>');
			$("#title").css("font-family", "Bungee");
			$("#title").html(e.layer.feature.properties.name);
			$("#info").html(e.layer.feature.properties.description);
			$("#gpx").prop('href', '../elba/KML/Vigniola.gpx');
			$("#kml").prop('href', '../elba/KML/Vigniola.kml');
			$("#infopanel").fadeIn("slow");
		});
		
	/*
	For highlighting features see:
	http://stackoverflow.com/questions/32971673/how-do-you-make-a-highlighted-outline-appear-in-leaflet-js-on-mouseover-and-by-h
	*/	
		
	}
	var style = {
		'default': {
			'weight': 3,
			'opacity': 0.7,
			'color': function(layer) {if layer.feature.properties.name = "Scalette" return "red" else return "green"}
		},
		'highlight': {
			'weight': 5,
			'opacity': 0.9
		}
	};

	// Variable for storing highlighted layer
	var highlight;

	function setHighlight (layer) {
	  // Check if something's highlighted, if so unset highlight
	  if (highlight) {
		unsetHighlight(highlight);
	  }
	  // Set highlight style on layer and store to variable
	  layer.setStyle(style.highlight);
	  highlight = layer;
	}

	function unsetHighlight (layer) {
	  // Set default style and clear variable
	  layer.setStyle(style.default);
	  highlight = null;
	}

	var groupKML = new L.LayerGroup([
		CimaDelMonteKML,
		LaghettoRossoKML,
		LaBuccaDelBandito1KML,
		LaBuccaDelBandito2KML,		
		MezzaStregaKML,
		ScaletteKML,
		StregaKML,
		VigniolaKML
	]);

	// Iterate over groupKML
	groupKML.eachLayer(function (layer) {

		// Mouseover handler
		layer.on('mouseover', function (e) {
			// Set highlight
			setHighlight(layer);
			$("#layer-name-info").html(e.layer.feature.properties.name);
			console.log(e.latlng);
			console.log(latLngToLayerPoint(e.latlng));
			
		});

		// Mouseout handler
		layer.on('mouseout', function (e) {
			 // Unset highlight
			unsetHighlight(layer);
			$("#layer-name-info").html('...');
		});
		
		layer.on('ready', function() { 
					layer.setStyle(style.default);
					});	
	});

	var trails = {
	  "Laghetto Rosso": LaghettoRossoKML,
	  "LaBuccaDelBandito - Cima Del Monte": LaBuccaDelBandito1KML,
	  "LaBuccaDelBandito - Via Volterraio": LaBuccaDelBandito2KML,
	  "Laghetto Rosso": LaghettoRossoKML,
	  "Scalette": ScaletteKML,
	  "Strega": StregaKML,
	  "Mezza Strega": MezzaStregaKML,
	  "Vigniola": VigniolaKML
	};		

	var baseLayers = {
	  "Satellit": mapbox_satelliteLayer,
	  "Terrain": mapbox_outdoorLayer
	};

	var map = L.map('map', {
	  center: [42.808660, 10.393714],
	  zoom: 13,
	  zoomControl: false,
	  layers: [mapbox_outdoorLayer, groupKML]
	});
	
	new L.Control.Zoom({ position: 'topright' }).addTo(map);
	
	var toggle = L.easyButton({
	  position: 'topright',
	  states: [{
		stateName: 'basemap-outdoor',
		icon: '<span class="custom-control">T</span>',
		title: 'change basemap back to satellite',		
		onClick: function(control) {
		  map.removeLayer(mapbox_outdoorLayer);
		  map.addLayer(mapbox_satelliteLayer);
		  control.state('basemap-satellite');
		}
	  }, {
		stateName: 'basemap-satellite',
		icon: '<span class="custom-control">S</span>',
		title: 'change basemap to outdoor/terrain',
		onClick: function(control) {
		  map.removeLayer(mapbox_satelliteLayer);
		  map.addLayer(mapbox_outdoorLayer);
		  control.state('basemap-outdoor');
		},
	  }]
	});	
	
	toggle.addTo(map);
	
	/*
	L.control.layers(baseLayers).addTo(map);
	L.control.locate({
		strings: {
			title: "Show me where I am, yo!"
		}

	}).addTo(map);
	*/
	
	map.on('click', function() {
		$("#infopanel").fadeOut("slow");	
	});

</script>
</body>	
</html>
