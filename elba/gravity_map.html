<html>
<head>
	<meta charset=utf-8>
		<title>ELBA GRAVITY PARK</title>
    </meta>		
	<link rel="stylesheet" href="https://domoritz.github.io/leaflet-locatecontrol/dist/L.Control.Locate.min.css" />
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">	
	<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
	<script src="https://domoritz.github.io/leaflet-locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
	<script src="//lightwidget.com/widgets/lightwidget.js"></script><
    <style type="text/css">
      html, body {
        height: 100%;
        padding: 0;
        margin: 0;
      }
      #map {
        position: absolute;
        width: 100%;
        height: 100%;
      }
	</style>
</head>
<body>
<div id="map"></div>
	<script language="javascript">

		var mtbmapAttr = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
		  '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
		  'Tiles ï¿½ <a href="http://mtbmap.cz">mtbmap</a>';
		  
		var mtbmapUrl = 'http://tile.mtbmap.cz/mtbmap_tiles/{z}/{x}/{y}.png';
		
		var mtbmapLayer = L.tileLayer(mtbmapUrl, {
		  attribution: mtbmapAttr
		});		

		var mapbox_Attr = 'Tiles &copy; <a href="https://www.mapbox.com">mapbox</a>';  
		var mapbox_satelliteUrl = 'https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZ2ltb3lhIiwiYSI6IkZrTld6NmcifQ.eY6Ymt2kVLvPQ6A2Dt9zAQ';
		var mapbox_outdoorUrl = 'https://api.mapbox.com/styles/v1/mapbox/outdoors-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZ2ltb3lhIiwiYSI6IkZrTld6NmcifQ.eY6Ymt2kVLvPQ6A2Dt9zAQ';

		var mapbox_satelliteLayer = L.tileLayer(mapbox_satelliteUrl, {
		  attribution: mapbox_Attr 
		});
		
		var mapbox_outdoorLayer = L.tileLayer(mapbox_outdoorUrl, {
		  attribution: mapbox_Attr 
		});		
				
		var ScaletteKML = omnivore.kml('../elba/KML/Scalette.kml')
			.on('ready', function() {
							// After the 'ready' event fires, the GeoJSON contents are accessible
							// and you can iterate through layers to bind custom popups
							this.eachLayer(function(layer) {
								// See the `.bindPopup` documentation for full details
								layer.bindPopup('<style>td {font-size: 1.5ex;} span {font-size: 2ex;}"</style><span><strong>'+layer.feature.properties.name+'</strong></span><p/>'+layer.feature.properties.description);
								layer.setStyle({weight: 3,
												opacity: 0.7,
												color: 'green',
												dashArray: '4'}) 
							});
						});
						
		var VignolaKML = omnivore.kml('../elba/KML/Vignola.kml')
			.on('ready', function() {
							// After the 'ready' event fires, the GeoJSON contents are accessible
							// and you can iterate through layers to bind custom popups
							this.eachLayer(function(layer) {
								// See the `.bindPopup` documentation for full details
								layer.bindPopup('<style>td {font-size: 1.5ex;} span {font-size: 2ex;}"</style><span><strong>'+layer.feature.properties.name+'</strong></span><p/>'+layer.feature.properties.description);
								layer.setStyle({weight: 3,
												opacity: 0.7,
												color: 'blue',
												dashArray: '4'}) 
							});
						});				
						
		var LaghettoRossoKML = omnivore.kml('../elba/KML/LaghettoRosso.kml')
			.on('ready', function() {
							// After the 'ready' event fires, the GeoJSON contents are accessible
							// and you can iterate through layers to bind custom popups
							this.eachLayer(function(layer) {
								// See the `.bindPopup` documentation for full details
								layer.bindPopup('<style>td {font-size: 1.5ex;} span {font-size: 2ex;}"</style><span><strong>'+layer.feature.properties.name+'</strong></span><p/>'+layer.feature.properties.description);
								layer.setStyle({weight: 3,
												opacity: 0.7,
												color: 'yellow',
												dashArray: '4'}) 
							});
						});				
						
		var MezzaStregaKML = omnivore.kml('../elba/KML/	MezzaStrega.kml')
			.on('ready', function() {
							// After the 'ready' event fires, the GeoJSON contents are accessible
							// and you can iterate through layers to bind custom popups
							this.eachLayer(function(layer) {
								// See the `.bindPopup` documentation for full details
								layer.bindPopup('<iframe src="//lightwidget.com/widgets/507c6df0bd205465a5f647e148c6220c.html" scrolling="no" allowtransparency="true" class="lightwidget-widget" style="width: 100%; border: 0; overflow: hidden;"></iframe>');
								layer.setStyle({weight: 3,
												opacity: 0.7,
												color: 'red',
												dashArray: '4'}) 
							});
						});
		/*
		For highlighting features see:
		http://stackoverflow.com/questions/32971673/how-do-you-make-a-highlighted-outline-appear-in-leaflet-js-on-mouseover-and-by-h
		*/	

		var style = {
			'default': {
				'weight': 3,
				'opacity': 0.7
			},
			'highlight': {
				'weight': 5,
				'opacity': 0.9
			}
		};
		
		// Variable for storing highlighted layer
		var highlight;

		function setHighlight (layer) {
		  // Check if something's highlighted, if so unset highlight
		  if (highlight) {
			unsetHighlight(highlight);
		  }
		  // Set highlight style on layer and store to variable
		  layer.setStyle(style.highlight);
		  highlight = layer;
		}

		function unsetHighlight (layer) {
		  // Set default style and clear variable
		  layer.setStyle(style.default);
		  highlight = null;
		}

		var groupKML = new L.LayerGroup([
			ScaletteKML,
			MezzaStregaKML,
			VignolaKML,
			LaghettoRossoKML
		]);

		// Iterate over groupKML
		groupKML.eachLayer(function (layer) {
		
			// Mouseover handler
			layer.on('mouseover', function (e) {
				// Set highlight
				setHighlight(layer);
			});

			// Mouseout handler
			layer.on('mouseout', function (e) {
				 // Unset highlight
				unsetHighlight(layer);
			});
		});
		
		var trails = {
		  "Scalette": ScaletteKML,
		  "Mezza Strega": MezzaStregaKML,
		  "Vignola": VignolaKML,
		  "Laghetto Rosso": LaghettoRossoKML
		};		

		var baseLayers = {
		  "Satellit": mapbox_satelliteLayer,
		  "Terrain": mapbox_outdoorLayer,		  
		  "OSM-MTBMap": mtbmapLayer
		};
			 
		var map = L.map('map', {
		  center: [42.79,10.28],
		  zoom: 12,
		  layers: [mapbox_outdoorLayer, ScaletteKML, VignolaKML, LaghettoRossoKML, MezzaStregaKML]
		});
		
		L.control.layers(baseLayers, trails).addTo(map);
		L.control.locate({
			strings: {
				title: "Show me where I am, yo!"
			}
		}).addTo(map);
	</script>
</body>	
</html>