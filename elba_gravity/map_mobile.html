<html>
<head>

<title>ELBA GRAVITY PARK</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />


	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>	
		
	<!-- GOOGLE FONTS -->	
	<link href='//fonts.googleapis.com/css?family=Bangers|Fugaz+One|Hanalei|Ranga|Ultra|Exo:Bold|Fredoka+One|Sigmar+One|Bungee+Inline|Creepster|Ewert|Fruktur|Monoton|Rubik:900' rel='stylesheet' type='text/css'>	
	<!-- GOOGLE FONTS -->	

	<!-- LEAFLET -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css"
	  integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ=="
	  crossorigin=""/>
	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"
	  integrity="sha512-A7vV8IFfih/D732iSSKi20u/ooOfj/AGehOKq0f4vLT1Zr2Y+RX7C+w8A1gaSasGtRUZpF/NZgzSAu4/Gc41Lg=="
	  crossorigin=""></script>
	<!-- LEAFLET -->
	
	<!-- Locate Control -->
	<link rel="stylesheet" href="Styles/L.Control.Locate.min.css" />
	<script src="Scripts/L.Control.Locate.min.js" charset="utf-8"></script>
	<!-- Locate Control -->
	
	<!-- LEAFLET Plugins -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet-easybutton@2.0.0/src/easy-button.css">		
	<script src="https://unpkg.com/leaflet-easybutton@2.0.0/src/easy-button.js"></script>
	<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
	<!-- LEAFLET Plugins -->	
	
	<!-- BOOTSTRAP -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">		
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>	
	<!-- BOOTSTRAP -->
		
	<!-- Leaflet Awesome Markers & FONT Awesome -->
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">	
	<script src="Leaflet.awesome-markers-2.0/dist/leaflet.awesome-markers.js"></script>
	<link rel="stylesheet" href="Leaflet.awesome-markers-2.0/dist/leaflet.awesome-markers.css">
	<!-- Leaflet Awesome Markers -->
	
    <style type="text/css">
	    
	html, body {
		font-size: 100%;
		height: 100%;
		padding: 0;
		margin: 0;
	}
	    
	#map {
		position: absolute;
		width: 100%;
		height: 100%;
	}	    
	    
	.awesome-marker i {
	    font-size: 16px;
	    margin-top: 10px;
	}
	    
	.custom-control {
		font-family: Exo;
	}
	
	span.fa-map-marker.fa {
		margin-top: 5px;
	}
	
	/* 
	custom link styling:
	*/  
	a {
		transition: color .4s;
	}

	a:link, a:visited { 
		color: #f9ff00; 
	}

	a:hover   { color: #7FDBFF; }
	a:active  {
		transition: color .3s;
		color: #007BE6;
	}	
	
	// exceptation for control links..
	.leaflet-bar a {
	    color: darkslategrey;
	}
	    
	#infopanel-right {		
		position: absolute;
		display: none;
		width: 100%;
		bottom: 0px;
		right: 0px;
		z-index: 999; 
		background-color: rgba(0,0,0, 0.25);		
		color: white;
	}

	.info-row {
	    padding: 10px;
	    text-align: center;
	}  
	    
	#layer-name-info, #poi-info {
		font-family: 'Corbel', 'bold';
		font-size: 2.7em;
	}
	    
	#layer-name-info {
		background-color: rgba(255,255,255,0.1);
	}
	
	#close {
		font-family: Corbel;
		float: right;
		display: inline-block;
		padding: 2px 5px;
		background: #ccc;
	}
	</style>
</head>
	
<body>
	<div id="infopanel-right">
		<div class="info-row" id="layer-name-info"><span id='close' onclick='$(this).parent().parent().hide();'>X</span></div>
		<div class="info-row" id="poi-info"></div>
	</div>
	
	<div id="map"></div>
	
	<script language="javascript">
		
		var map = L.map('map', {
		  center: [42.808660, 10.393714],
		  zoom: 13,
		  maxZoom: 17,
		  minZoom: 11,
		  zoomControl: false
		});
		
		new L.Control.Zoom({ position: 'topright' }).addTo(map);

		var toggle = L.easyButton({
		  position: 'topright',
		  states: [{
			stateName: 'basemap-outdoor',
			icon: '<span class="custom-control">T</span>',
			title: 'change basemap back to satellite',		
			onClick: function(control) {
			  map.removeLayer(mapbox_outdoorLayer);
			  map.addLayer(mapbox_satelliteLayer);
			  control.state('basemap-satellite');
			}
		  }, {
			stateName: 'basemap-satellite',
			icon: '<span class="custom-control">S</span>',
			title: 'change basemap to outdoor/terrain',
			onClick: function(control) {
			  map.removeLayer(mapbox_satelliteLayer);
			  map.addLayer(mapbox_outdoorLayer);
			  control.state('basemap-outdoor');
			},
		  }]
		});	

		toggle.addTo(map);

		L.control.locate({
			strings: {
				title: "Show me where I am, yo!"
			}

		}).addTo(map);

		var mapbox_Attr = 'Tiles &copy; <a href="https://www.mapbox.com">mapbox</a>';  
		var mapbox_satelliteUrl = 'https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZ2ltb3lhIiwiYSI6IkZrTld6NmcifQ.eY6Ymt2kVLvPQ6A2Dt9zAQ';
		var mapbox_outdoorUrl = 'https://api.mapbox.com/styles/v1/mapbox/outdoors-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZ2ltb3lhIiwiYSI6IkZrTld6NmcifQ.eY6Ymt2kVLvPQ6A2Dt9zAQ';

		var mapbox_satelliteLayer = L.tileLayer(mapbox_satelliteUrl, {
		  attribution: mapbox_Attr 
		});

		var mapbox_outdoorLayer = L.tileLayer(mapbox_outdoorUrl, {
		  attribution: mapbox_Attr 
		});		

		mapbox_outdoorLayer.addTo(map);		
		
		var trailColors = {
				   "Scalette": "#eb7b03", 
				   "Vigniola": "#6826ce", 
				   "Strega": "#d7374c", 
				   "Mezza Strega": "#54ff00",
				   "Bucca Del Bandito - Via Volterraio": "#009b2e", 
				   "Bucca Del Bandito - Cima Del Monte": "#009b2e", 
				   "Cima Del Monte - Porto Azzurro": "#286090",
				   "Laghetto Rosso": "#fc2500"
		};
		
		function trailClick(e, layer, font) {
			$("#layer-name-info").css("font-family", font)
				.html(e.layer.feature.properties.name)
				.css('color', trailColors[e.layer.feature.properties.name]);
			$("#infopanel-right").fadeIn("slow");
		}
		
		var CimaDelMonteKML = omnivore.kml('KML/CimaDelMonte.kml')
			.on('click', function(e) {trailClick(e, layer, font)});
		/*
			.on('click', function(e) {
				$("#layer-name-info").css("font-family", "Fruktur")				
					.html(e.layer.feature.properties.name)
					.css('color', trailColors[e.layer.feature.properties.name]);
				$("#infopanel-right").fadeIn("slow");
			})
		*/
		var BuccaDelBandito1KML = omnivore.kml('KML/BuccaDelBandito1.kml')
			.on('click', function(e) {
				$("#layer-name-info").css("font-family", "Creepster")
					.html(e.layer.feature.properties.name)
					.css('color', trailColors[e.layer.feature.properties.name]);
				$("#infopanel-right").fadeIn("slow");				
			});			

		var BuccaDelBandito2KML = omnivore.kml('KML/BuccaDelBandito2.kml')
			.on('click', function(e) {
				$("#layer-name-info").css("font-family", "Creepster")
					.html(e.layer.feature.properties.name)
					.css('color', trailColors[e.layer.feature.properties.name]);
				$("#infopanel-right").fadeIn("slow");
			});

		var LaghettoRossoKML = omnivore.kml('KML/LaghettoRosso.kml')
			.on('click', function(e) {
				$("#layer-name-info").css("font-family", "Ultra")
					.html(e.layer.feature.properties.name)
					.css('color', trailColors[e.layer.feature.properties.name]);
				$("#infopanel-right").fadeIn("slow");
			});			

		var MezzaStregaKML = omnivore.kml('KML/MezzaStrega.kml')
			.on('click', function(e) {
				$("#layer-name-info").css("font-family", "Ewert")
					.html(e.layer.feature.properties.name)
					.css('color', trailColors[e.layer.feature.properties.name]);
				$("#infopanel-right").fadeIn("slow");				
			});

		var StregaKML = omnivore.kml('KML/Strega.kml', null)
			.on('click', function(e) {
				$("#layer-name-info").css("font-family", "Fugaz One")
					.html(e.layer.feature.properties.name)
					.css('color', trailColors[e.layer.feature.properties.name]);
				$("#infopanel-right").fadeIn("slow");			
			});

		var ScaletteKML = omnivore.kml('KML/Scalette.kml')
			.on('click', function(e) {
				$("#layer-name-info").css("font-family", "Hanalei")
					.html(e.layer.feature.properties.name)
					.css('color', trailColors[e.layer.feature.properties.name]);
				$("#infopanel-right").fadeIn("slow");				
			});			

		var VigniolaKML = omnivore.kml('KML/Vigniola.kml')
			.on('click', function(e) {
				$("#layer-name-info").css("font-family", "Bungee Inline")
					.html(e.layer.feature.properties.name)
					.css('color', trailColors[e.layer.feature.properties.name]);
				$("#infopanel-right").fadeIn("slow");			
			});

		/*
		For highlighting features see:
		http://stackoverflow.com/questions/32971673/how-do-you-make-a-highlighted-outline-appear-in-leaflet-js-on-mouseover-and-by-h
		*/	

		var style = {
			'default': {
				'weight': 5,
				'opacity': 0.4
			},
			'highlight': {
				'weight': 7,
				'opacity': 0.6
			}
		};

		// Variable for storing highlighted layer
		var highlight;

		function setHighlight (layer) {
		  // Check if something's highlighted, if so unset highlight
		  if (highlight) {
			unsetHighlight(highlight);
		  }
		  // Set highlight style on layer and store to variable
		  layer.setStyle(style.highlight);
		  highlight = layer;
		}

		function unsetHighlight (layer) {
		  // Set default style and clear variable
		  layer.setStyle(style.default);
		  highlight = null;
		}

		var groupKML = new L.LayerGroup([
			CimaDelMonteKML,
			LaghettoRossoKML,
			BuccaDelBandito1KML,
			BuccaDelBandito2KML,		
			MezzaStregaKML,
			ScaletteKML,
			StregaKML,
			VigniolaKML
		]);

		// used icons for markers:
		L.AwesomeMarkers.Icon.prototype.options.prefix = 'fa';

		var endIcon = L.AwesomeMarkers.icon({
			    icon: 'fa-flag-checkered',
			    markerColor: 'cadetblue',
			    iconColor: 'white'
			  });

		var startIcon = L.AwesomeMarkers.icon({
			    icon: 'fa-hand-o-down',
			    markerColor: 'green',
			    iconColor: 'white'
			  });	

		var bikeRentIcon = L.AwesomeMarkers.icon({
			    icon: 'fa-bicycle',
			    markerColor: 'blue',
			    iconColor: 'yellow'
			  });	

		var bikeLoadingIcon = L.AwesomeMarkers.icon({
			    icon: 'fa-truck',
			    markerColor: 'purple',
			    iconColor: 'yellow'
			  });	

		function openShopURL(e) {
			$("#layer-name-info").html('');
			$("#poi-info").html('Go to:</br><a href="http://www.elbagravitybikerent.it/" target="_blank";>Elba Gravity</br>Bike Shop/Rent</a>');
			$("#infopanel-right").fadeIn("slow");
			// console.log(latLngToLayerPoint(e.latlng));			
		}

		function showTelDario(e) {
			$("#layer-name-info").html('');
			$("#poi-info").html('Shuttle Call</br><a href="tel:+39 320 264 9391">+39 320 264 9391</a>');
			$("#infopanel-right").fadeIn("slow");
			// console.log(latLngToLayerPoint(e.latlng));
		}
		
		var bikeLoadingPts = [
			[42.799289, 10.357636],
			[42.860381, 10.420435],
			[42.843782, 10.400274],
			[42.770250, 10.390604]
		];
		
		new L.marker([42.81376, 10.3989717], {icon: bikeRentIcon})
			.on('click', openShopURL)
			.addTo(map);	
		
		for (i = 0; i < bikeLoadingPts.length; i++) { 
			new L.marker(bikeLoadingPts[i], {icon: bikeLoadingIcon})
				.on('click', showTelDario)
				.addTo(map);
		}
		
		// Iterate over groupKML and make end and start markers, then attach event listeners..	
		groupKML.eachLayer(function (layer) {	

			layer.on('ready', function() { 
				var latlngs = layer.getLayers(0)[0]._latlngs;
				var endPt = new L.marker(latlngs[latlngs.length - 1], {icon: endIcon});
				var startPt = new L.marker(latlngs[0], {icon: startIcon});
				endPt.addTo(map);
				startPt.addTo(map);
				layer.setStyle({
					'weight': 5,
					'color': trailColors[layer.getLayers()[0].feature.properties.name]
				});
			});			
		});

		map.addLayer(groupKML);

	</script>
</body>	
</html>
